/*!
* Skew v0.7.1
* Copyright 2018 Marcin Walczak
*This file is part of Skew which is released under MIT license.
*See LICENSE for full license details.
*/
function Skew(e,t){"string"==typeof e?this.targets=document.querySelectorAll(e):e.nodeType?this.targets=[e]:this.targets=e,this.defaults={x:0,y:0,unskewContent:!1,breakpoints:[],debounce:!0,debounceTime:50,beforeSkewListeners:[],afterSkewListeners:[],beforeElementSkewListeners:[],afterElementSkewListeners:[]},this.options=this.defaults,this.currentUnskewContent=this.options.unskewContent,this.timeout,this.update(t);var o=this;return this.eventMethod=function(){var t=o.options.debounce,n=o.options.debounceTime;if(void 0!==o.options.breakpoints){var s=window.innerWidth;o.options.breakpoints.forEach(function(e){e.break>=s&&(void 0!==e.debounce&&(t=e.debounce),void 0!==e.debounceTime&&(n=e.debounceTime))})}if(t){clearTimeout(o.timeout),o.timeout=setTimeout(function(){o.timeout=null,o.skew()},n)}else o.skew()},window.addEventListener("load",this.eventMethod),window.addEventListener("resize",this.eventMethod),this}window.jQuery&&($.fn.skew=function(s){$.makeArray(arguments);return this.each(function(){var e=$.data(this,"skewjs");if(e)if("string"==typeof s)e[s]?(e[s].apply(e,t),"destroy"==s&&$.removeData(this,"skewjs")):$.error("Method "+s+" does not exist on Skew");else{var t=$.extend({x:0,y:0,breakpoints:[]},s);e.update(t)}else if("string"!=typeof s){var n=new Skew(this,t=$.extend({x:0,y:0,breakpoints:[]},s));return $.data(this,"skewjs",n),n}})}),Skew.prototype={skew:function(){var e=this,t=null,n=0,s=0,o=e.options.x,r=e.options.y,i=0,u=0;if(content=[],unskewContent=e.options.unskewContent,contentSkewStyle="",void 0!==e.options.breakpoints){var a=window.innerWidth;if(e.options.breakpoints.forEach(function(e){e.break<a||(void 0!==e.x&&(o=e.x),void 0!==e.y&&(r=e.y),void 0!==e.unskewContent&&(unskewContent=e.unskewContent))}),e.currentUnskewContent!==unskewContent){for(var k=0;k<e.targets.length;k++){t=e.targets[k],!0===e.currentUnskewContent?content=t.childNodes:"string"==typeof e.currentUnskewContent&&""!=e.currentUnskewContent&&(content=t.querySelectorAll(e.currentUnskewContent));for(var f=0;f<content.length;f++)e.setSkewStyle(content[f],"")}content=[],e.currentUnskewContent=unskewContent}}for(k=0;k<this.options.beforeSkewListeners.length;k++)this.options.beforeSkewListeners[k](e,e.targets);for(k=0;k<e.targets.length;k++){t=e.targets[k];for(f=0;f<this.options.beforeElementSkewListeners.length;f++)this.options.beforeElementSkewListeners[f](e,t);n=t.offsetWidth,s=t.offsetHeight,i=Math.atan(o/s),u=Math.atan(r/n),skewStyle="skew("+i+"rad, "+u+"rad)",e.setSkewStyle(t,skewStyle),!0===unskewContent?content=t.childNodes:"string"==typeof unskewContent&&""!=unskewContent&&(content=t.querySelectorAll(unskewContent)),contentSkewStyle="skew("+-i+"rad, "+-u+"rad)";for(f=0;f<content.length;f++)e.setSkewStyle(content[f],contentSkewStyle);for(f=0;f<this.options.afterElementSkewListeners.length;f++)this.options.afterElementSkewListeners[f](e,t)}for(k=0;k<this.options.afterSkewListeners.length;k++)this.options.afterSkewListeners[k](e,e.targets);return this},update:function(e){return this.options=this.parseSettings(e,this.options),this.skew(),this},destroy:function(){window.removeEventListener("resize",this.resizeEvent);for(var e=0;e<this.targets.length;e++){var t=this.targets[e],n=t.getAttribute("style"),s=n.indexOf("skew"),o=s+n.substring(s).indexOf(")")+1;if(-1<s){var r=n.substring(0,s),i=n.substring(o);t.setAttribute("style",r+i)}}},parseSettings:function(e,t){var n=void 0!==t?t:this.defaults,s=function(t,e){void 0!==e&&(Array.isArray(e)?e.forEach(function(e){t.push(e)}):t.push(e))};return void 0!==e&&(void 0!==e.x&&(n.x=e.x),void 0!==e.y&&(n.y=e.y),void 0!==e.unskewContent&&(n.unskewContent=e.unskewContent),Array.isArray(e.breakpoints)&&(n.breakpoints=[],e.breakpoints.forEach(function(e){var t={break:void 0!==e.break?e.break:0};void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.unskewContent&&(t.unskewContent=e.unskewContent),void 0!==e.debounce&&(t.debounce=e.debounce),void 0!==e.debounceTime&&(t.debounce=e.debounceTime),n.breakpoints.push(t)}),n.breakpoints.sort(function(e,t){return e.break<t.break?1:e.break>t.break?-1:0})),void 0!==e.debounce&&(n.debounce=e.debounce),void 0!==e.debounceTime&&(n.debounceTime=e.debounceTime),n.beforeSkewListeners=t.beforeSkewListeners,s(n.beforeSkewListeners,e.beforeSkew),n.afterSkewListeners=t.afterSkewListeners,s(n.afterSkewListeners,e.afterSkew),n.beforeElementSkewListeners=t.beforeElementSkewListeners,s(n.beforeElementSkewListeners,e.beforeElementSkew),n.afterElementSkewListeners=t.afterElementSkewListeners,s(n.afterElementSkewListeners,e.afterElementSkew)),n},setSkewStyle:function(e,t){if(e.nodeType==Node.ELEMENT_NODE){var n=e.getAttribute("style");if(null===n)return n="transform: "+t+";",void e.setAttribute("style",n);var s=n.indexOf("transform:");if(s<0)return n+="transform: "+t+";",void e.setAttribute("style",n);var o=s+n.substring(s).indexOf(";");o<s&&(o=n.length,t+=";");var r=n.indexOf("skew"),i=n.substring(0,o),u=n.substring(o);if(r<0)return n=i+" "+t+u,void e.setAttribute("style",n);o=(s=n.indexOf("skew"))+n.substring(s).indexOf(")")+1,n=(i=n.substring(0,s))+t+(u=n.substring(o)),e.setAttribute("style",n)}},beforeSkew:function(e){return this.options.beforeSkewListeners.push(e),this},afterSkew:function(e){return this.options.afterSkewListeners.push(e),this},beforeElementSkew:function(e){return this.options.beforeElementSkewListeners.push(e),this},afterElementSkew:function(e){return this.options.afterElementSkewListeners.push(e),this}};
